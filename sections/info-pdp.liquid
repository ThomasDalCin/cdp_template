<!--info pdp section-->
<div class="w-full h-auto flex items-start justify-center flex-col">
    <!--product title container-->
    <div class="w-full h-auto flex items-center justify-start px-6 pt-10 lg:px-20 lg:py-12">
        <h1 class="text-[64px] leading-[56px] tt-norms-pro-light lg:text-[128px] lg:leading-[128px]">{{ product.title }}
        </h1>
    </div>
    <!--product info box container-->
    <!-- Product details section -->
    <div class="w-full h-auto overflow-x-hidden lg:px-20 ">
        <div
            class="product-details-component w-full h-auto px-6 flex flex-col gap-y-2 lg:pb-[40px] lg:px-0 lg:gap-y-16 lg:border-b lg:border-[#A9A09E]">
            <div
                class="w-full h-auto flex items-start justify-center flex-col lg:flex-row-reverse lg:items-center lg:justify-start lg:gap-x-20">
                <!--box container -->
                <div
                    class="product-details-magnetic-scroll w-full  py-6 h-auto flex flex-row items-center justify-start gap-x-2 lg:w-full">
                    {% assign productMetafieldsValues = 'top_speed,lenght,dry_weight' | split: ',' %}
                    {% for productMetafieldsValue in productMetafieldsValues %}
                    {% assign metafieldCustom = product.metafields.custom[productMetafieldsValue].value %}
                    <div
                        class="details-badge flex flex-1 flex-col h-auto items-center justify-center gap-y-1 rounded-[10px] bg-[#EFEEED] lg:h-[100px] lg:flex-1">
                        <p class="body-12 text-[#818181] tt-norms-pro-med badge-text text-nowrap">{{ productMetafieldsValue | replace: '_', ' '
                            |
                            upcase
                            }}
                        </p>
                        <p class="body-14 text-nowrap tt-norms-pro-med badge-value">{{ metafieldCustom }}</p>
                    </div>
                    {% endfor %}
                </div>

                <!--product description container -->
                <div
                    class="product-detaiils-component-main w-full h-auto pt-4 pb-6 flex flex-col gap-y-2 items-start justify-start">
                    {% if product.description and product.description != '' %}
                    <p class="body-14">{{ product.description | raw }}</p>
                    {% endif %}
                </div>
            </div>

            <!--emotional text container-->
            <div class="w-full h-auto flex items-center justify-center px-6 py-14 lg:bg-[#F7F7F7] lg:rounded-[32px]">
                <p
                    class="text-[32px] leading-[38px] tt-norms-pro-light text-center text-balance lg:text-[64px] lg:leading-[64px]">
                    {{
                    section.settings.ispirational_text |
                    default: "Lorem ipsum dolor sit,
                    consectutor adipis mar tiss partiem." }}</p>
            </div>

            <!--product cta container-->
            <div
                class="product-details-cta w-full h-auto flex flex-col items-center justify-start gap-y-3 lg:flex-row lg:gap-x-3 lg:justify-center">
                <div class="cta-choco lg:w-[220px] h-[48px] min-h-[48px] lg:px-4 lg:py-2">
                    <a href="/pages/locate-delear">
                        <p class="body-14-medium">{{ section.settings.cta_delear | default: "Find a delear" }}</p>
                    </a>
                </div>
                <div class="cta-transparent h-[48px] min-h-[48px] lg:w-[220px]  lg:px-4 lg:py-2 cta-brochure">
                    <p class="body-14-medium">{{ section.settings.cta_brochure | default: "Get the brochure" }}</p>
                    {% render 'download-icon-black' %}
                </div>
            </div>
        </div>
    </div>

</div>


<!-- Form Container -->
<div id="form-container"
    class="form-container fixed bottom-0 left-0 w-full h-auto bg-white p-6 rounded-t-lg shadow-custom z-50 translate-y-full transition-transform duration-300 ease-in-out">
    <div class="wrapper-form-appointment w-full flex flex-col gap-y-6 mx-auto lg:w-[640px] lg:max-h-[600px]">

        <!-- Form Header -->
        <div class="form-appointment-headers w-full flex items-center justify-end relative">
            <p class="body-14-medium events-name absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">{{
                section.settings.form_title | default: "Get the brochure" }}</p>

            <!-- Close Icon -->
            <div class="icon-content cursor-pointer close-form">
                {% render 'x-icon' %}
            </div>
        </div>

        <!-- Form Content -->

        {% form 'customer', class: "flex flex-col items-start justify-center gap-y-6" %}

        {% if form.posted_successfully? %}
        <div
            class="w-full h-[60px] fixed left-0 right-0 bottom-4 bg-white z-50 flex items-center justify-start gap-x-2 flex-row rounded-xl border border-black">
            {% render 'check-icon' %}
            <p class="body-14">{{ section.settings.thankyou_message | default: "Richiesta brochure avvenuta" }}</p>
        </div>
        {% else %}

        <!-- Form Errors -->
        {{ form.errors | default_errors }}
        <div class="w-full h-auto flex flex-col items-start justify-center gap-y-3">
            <!-- First Name -->
            <div class="form-group w-full">
                <input type="text" name="contact[first_name]"
                    class=" w-full p-3 rounded-lg bg-[var(--primary-background-color)] border-[0.5px]  border-transparent focus:outline-none focus:border-black placeholder:body-14 placeholder:text-[#818181]"
                    value="{% if form.first_name != blank %}{{ form.first_name }}{% endif %}"
                    placeholder="{{ section.settings.first_name_placeholder |  default: " Name" }}" required>
            </div>

            <!-- Last Name -->
            <div class="form-group w-full">
                <input type="text" name="contact[last_name]"
                    class=" w-full p-3  rounded-lg bg-[var(--primary-background-color)] border-[0.5px] border-transparent focus:outline-none focus:border-black placeholder:body-14 placeholder:text-[#818181]"
                    value="{% if form.last_name != blank %}{{ form.last_name }}{% endif %}"
                    placeholder="{{ section.settings.last_name_placeholder |  default: " Last name" }}" required>
            </div>

            <!-- Email -->
            <div class="form-group w-full">
                <input type="email" name="contact[email]"
                    class=" w-full p-3  rounded-lg bg-[var(--primary-background-color)] border-[0.5px] border-transparent focus:outline-none focus:border-black placeholder:body-14 placeholder:text-[#818181]"
                    value="{% if form.email != blank %}{{ form.email }}{% endif %}"
                    placeholder="{{ section.settings.email_placeholder |  default: " Email" }}" required>
            </div>
        </div>


        <!--container checkbox-->
        <div class="w-full h-auto flex flex-col items-start justify-center gap-y-3">
            <!-- Marketing Consent Checkbox -->
            <div class="form-group w-full flex items-center gap-2">
                <input type="checkbox" id="marketingConsent" name="contact[marketing_consent]"
                    class="w-4 h-4 appearance-none border border-black rounded checked:bg-black checked:border-black focus:outline-none focus:ring-0">
                <label for="marketingConsent">
                    {{ section.settings.marketing_consent_label | default: "Direct Marketing" }}
                </label>
            </div>

            <!-- Profiling Consent Checkbox -->
            <div class="form-group w-full flex items-center gap-2">
                <input type="checkbox" id="profilingConsent" name="contact[profiling_consent]"
                    class="w-4 h-4 appearance-none border border-black rounded checked:bg-black checked:border-black focus:outline-none focus:ring-0">
                <label for="profilingConsent">
                    {{ section.settings.profiling_consent_label | default: "Profilazione" }}
                </label>
            </div>

        </div>
        <!-- Hidden Input for Brochure Tag -->
        <input type="hidden" name="contact[tags]" id="additionalTags" value="brochure">

        <!-- Submit Button -->
        <div class="cta-transparent w-full flex items-center justify-center submit-cta">
            <button type="submit" id="Subscribe" class="px-6 py-3">
                {{ section.settings.submit_button | default: "Get the brochure" }}
            </button>
        </div>
        {% endif %}
        {% endform %}

    </div>
</div>



<style>
    body.no-scroll {
        overflow: hidden;
    }

    .cta-transparent button:disabled {
        opacity: 0.2;
        cursor: not-allowed;
    }

    @media screen and (max-width: 440px) {
        .details-badge {
            width: 129.953px;
            max-width: 129.953px;
            padding: 16.372px;
        }
    }

    @media screen and (max-width: 430px) {
        .details-badge {
            width: 127px;
            max-width: 127px;
            padding: 16px;
        }

    }

    @media screen and (max-width: 393px) {
        .details-badge {
            width: 116.072px;
            max-width: 116.072px;
            padding: 14.623px;
        }
        .badge-text{
            font-size: 12.795px;
        }

        .badge-value{
            font-size: 10.967px;
        }


    }

    @media screen and (max-width: 375px) {
        .details-badge {
            width: 110.756px;
            max-width: 110.756px;
            padding: 13.953px;
        }

        .badge-text{
            font-size: 12.209px;
        }

        .badge-value{
            font-size: 10.465px;
        }
    }

    @media screen and (max-width: 320px) {
        .details-badge {
            width: 94.512px;
            max-width: 94.512px;
            padding: 11.907px;
        }

        .badge-text{
            font-size: 10.414px;
        }

        .badge-value{
            font-size: 8.93px;;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const ctaBrochure = document.querySelectorAll('.cta-brochure');
        const formContainer = document.getElementById('form-container');
        const overlay = document.getElementById('overlay');
        const closeForm = document.querySelector('.close-form');

        const submitButton = document.querySelector('.submit-cta');
        const formInputs = document.querySelectorAll('input[required]');
        const marketingCheckbox = document.getElementById('marketingConsent');
        const profilingCheckbox = document.getElementById('profilingConsent');
        const additionalTagsInput = document.getElementById('additionalTags');

        // Function to update submit button state
        const updateSubmitButtonState = () => {
            const allFieldsFilled = Array.from(formInputs).every(input => input.value.trim() !== '');
            if (allFieldsFilled) {
                submitButton.style.opacity = '1';
                submitButton.disabled = false;
            } else {
                submitButton.style.opacity = '.2';
                submitButton.disabled = true;
            }
        };

        // Initialize button state on load
        updateSubmitButtonState();

        // Add event listeners to all inputs
        formInputs.forEach(input => {
            input.addEventListener('input', updateSubmitButtonState);
        });

        // Open form logic
        ctaBrochure.forEach(cta => {
            cta.addEventListener('click', function (e) {
                e.preventDefault();

                // Show the form and overlay
                formContainer.classList.remove('translate-y-full');
                formContainer.classList.add('translate-y-0');
                overlay.classList.remove('hidden');
                document.body.classList.add('no-scroll');
            });
        });

        // Close form logic
        closeForm.addEventListener('click', function () {
            // Hide the form and overlay
            formContainer.classList.remove('translate-y-0');
            formContainer.classList.add('translate-y-full');
            overlay.classList.add('hidden');
            document.body.classList.remove('no-scroll');
        });

        // Update tags function
        const updateTags = () => {
            const tags = ['brochure']; // Static tag
            if (marketingCheckbox.checked) tags.push('marketing');
            if (profilingCheckbox.checked) tags.push('profilazione');
            additionalTagsInput.value = tags.join(',');
        };

        // Event listener for checkboxes
        marketingCheckbox.addEventListener('change', updateTags);
        profilingCheckbox.addEventListener('change', updateTags);

        // Initialize tags on load
        updateTags();
    });

</script>